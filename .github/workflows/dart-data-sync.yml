name: DART On-Demand Bootstrap (Manual)

on:
  workflow_dispatch:
    inputs:
      write_corp_master:
        description: "Also write corp_master table? (optional)"
        required: false
        default: "false"

jobs:
  bootstrap-corp-list:
    runs-on: ubuntu-latest
    env:
      OPENDART_API_KEY: ${{ secrets.OPENDART_API_KEY }}
      WRITE_CORP_MASTER: ${{ github.event.inputs.write_corp_master || 'false' }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Use Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Install dependencies
        run: npm ci

      - name: Validate required secret
        shell: bash
        run: |
          test -n "$OPENDART_API_KEY" || { echo "OPENDART_API_KEY is required"; exit 1; }

      - name: Refresh corp code list for on-demand search
        run: npm run fetch:corp-code-list

      - name: Print bootstrap summary
        run: |
          echo "write_corp_master=${WRITE_CORP_MASTER}"

